# 阳光商城——后端

## 介绍
本项目实现了一个基于微服务架构的智能搜索商城系统，包含用户、商品、交易等7个服务，通过网关统一接收请求并进行路由分发。采用Nacos作为注册中心和配置中心，使用MySQL存储业务数据，Redis缓存秒杀商品的信息。特别设计图像检索、语义检索模块，采用Flask框架将文本和图像嵌入为向量的深度学习模型封装成服务，并注册到Nacos。

## 技术栈
SpringCloud+SpringBoot+PyTorch+Flask+Mybatis+JWT+Redis+MySQL+Nacos+OpenFeign+Nginx+Docker+ES

## 特色
- 图像检索商品模块，基于深度学习PyTorch框架构建Swin Transformer模型提取图片特征，将商品图片嵌入为768维向量。
- 语义检索商品模块，基于sentence-bert的预训练模型处理商品描述文本，将商品描述文本嵌入为768维语义向量。
- 采用Elasticsearch存储商品以及图文向量，构建HNSW近似最近邻索引，采用余弦相似度实现毫秒级检索。在8万+商品库查询测试中，返回Top-20最相似结果平均耗时仅 9.47ms（num_candidates=1000）。
- 采用Redis的Zset以秒杀开始时间为得分(score)，商品id为成员(member)缓存秒杀商品，通过游标实现秒杀商品列表的快速查询，提升查询效率。
- 基于Redis+Lua脚本实现商品秒杀，采用Redis预扣减库存和资格校验提升并发，发送消息到RabbitMQ异步创建订单。
- 采用消息队列RabbitMQ进行异步监听，实现商品的上下架，以及使用延迟队列实现订单超时未支付的取消（包括秒杀订单库存回滚、订单超时取消）。
- 采用Seata处理分布式事务、Sentinel进行限流熔断。


## 微服务
- 用户服务（user-service）：提供用户注册、登录、查看用户信息、修改用户信息等功能。
- 商品服务（item-service）：提供商品查询、商品详情、商品分类等功能。
- 交易服务（trade-service）：提供订单创建、秒杀订单创建、订单查询、订单支付、订单取消等功能。
- 搜索服务（search-service）：提供商品搜索、**语义检索**、**图像检索**等功能。
- 购物车服务（cart-service）：提供购物车功能，用户可以在购物车中添加、删除商品。
- 网关服务（hm-gateway）：提供统一入口，将请求路由到对应的服务。